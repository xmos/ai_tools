<html>
<head>
<style>
body {font-family: sans-serif; background-color: #fa0;}
table {background-color: #eca;}
th {background-color: black; color: white;}
h1 {
  background-color: ffaa00;
  padding:5px;
  color: black;
}

svg {
  margin: 10px;
  border: 2px;
  border-style: solid;
  border-color: black;
  background: white;
}

div {
  border-radius: 5px;
  background-color: #fec;
  padding:5px;
  margin:5px;
}

.tooltip {color: blue;}
.tooltip .tooltipcontent  {
    visibility: hidden;
    color: black;
    background-color: yellow;
    padding: 5px;
    border-radius: 4px;
    position: absolute;
    z-index: 1;
}
.tooltip:hover .tooltipcontent {
    visibility: visible;
}

.edges line {
  stroke: #333;
}

text {
  font-weight: bold;
}

.nodes text {
  color: black;
  pointer-events: none;
  font-family: monospace;
  font-size: 12px;
}
</style>
<script src="https://d3js.org/d3.v5.min.js"></script>
</head>

<body>
<h1>TensorFlow Lite Model</h1>
<table><tr>
  <th>filename</th>
  <td>filename</td>
</tr><tr>
  <th>version</th>
  <td>version</td>
</tr><tr>
  <th>description</th>
  <td>description</td>
</tr></table>

<div class='subgraph'><h2>Subgraph 0</h2>
<h3>Inputs/Outputs</h3>
<table><tr>
  <th>inputs</th>
  <th>outputs</th>
</tr><tr>
  <td><span class='tooltip'><span class='tooltipcontent'>(5) input_input &ltFLOAT32&gt [1, 32, 1, 1] <br></span>[5]</span></td>
  <td><span class='tooltip'><span class='tooltipcontent'>(6) Identity &ltFLOAT32&gt [1, 4] <br></span>[6]</span></td>
</tr></table>

<h3>Tensors</h3>
<table><tr>
  <th>index</th>
  <th>name</th>
  <th>type</th>
  <th>shape</th>
  <th>buffer</th>
  <th>quantization</th>
</tr><tr>
  <td>0</td>
  <td>Identity_int8</td>
  <td>INT8</td>
  <td>[1, 4]</td>
  <td>5</td>
  <td>{'scale': [0.00390625], 'zero_point': [-128], 'details_type': 'NONE', 'quantized_dimension': 0}</td>
</tr><tr>
  <td>1</td>
  <td>fc_deepin_shallowout_final/ouptut/BiasAdd</td>
  <td>INT8</td>
  <td>[1, 4]</td>
  <td>4</td>
  <td>{'min': [-40.24191], 'max': [32.77966], 'scale': [0.2863591], 'zero_point': [13], 'details_type': 'NONE', 'quantized_dimension': 0}</td>
</tr><tr>
  <td>2</td>
  <td>fc_deepin_shallowout_final/ouptut/MatMul/ReadVariableOp/transpose</td>
  <td>INT8</td>
  <td>[4, 32]</td>
  <td>3</td>
  <td>{'scale': [0.007991377], 'zero_point': [0], 'details_type': 'NONE', 'quantized_dimension': 0}</td>
</tr><tr>
  <td>3</td>
  <td>fc_deepin_shallowout_final/ouptut/MatMul_bias</td>
  <td>INT32</td>
  <td>[4]</td>
  <td>1</td>
  <td>{'scale': [0.0002735302], 'zero_point': [0], 'details_type': 'NONE', 'quantized_dimension': 0}</td>
</tr><tr>
  <td>4</td>
  <td>input_input_int8</td>
  <td>INT8</td>
  <td>[1, 32, 1, 1]</td>
  <td>2</td>
  <td>{'min': [-4.295065], 'max': [4.433117], 'scale': [0.03422816], 'zero_point': [-3], 'details_type': 'NONE', 'quantized_dimension': 0}</td>
</tr><tr>
  <td>5</td>
  <td>input_input</td>
  <td>FLOAT32</td>
  <td>[1, 32, 1, 1]</td>
  <td>0</td>
  <td>None</td>
</tr><tr>
  <td>6</td>
  <td>Identity</td>
  <td>FLOAT32</td>
  <td>[1, 4]</td>
  <td>0</td>
  <td>None</td>
</tr></table>

<h3>Ops</h3>
<table><tr>
  <th>index</th>
  <th>inputs</th>
  <th>outputs</th>
  <th>opcode_index</th>
  <th>builtin_options</th>
  <th>custom_options</th>
</tr><tr>
  <td>0</td>
  <td><span class='tooltip'><span class='tooltipcontent'>(5) input_input &ltFLOAT32&gt [1, 32, 1, 1] <br></span>[5]</span></td>
  <td><span class='tooltip'><span class='tooltipcontent'>(4) input_input_int8 &ltINT8&gt [1, 32, 1, 1] <br></span>[4]</span></td>
  <td>(0) QUANTIZE</td>
  <td>None</td>
  <td>None</td>
</tr><tr>
  <td>1</td>
  <td><span class='tooltip'><span class='tooltipcontent'>(4) input_input_int8 &ltINT8&gt [1, 32, 1, 1] <br>(2) fc_deepin_shallowout_final/ouptut/MatMul/ReadVariableOp/transpose &ltINT8&gt [4, 32] <br>(3) fc_deepin_shallowout_final/ouptut/MatMul_bias &ltINT32&gt [4] <br></span>[4, 2, 3]</span></td>
  <td><span class='tooltip'><span class='tooltipcontent'>(1) fc_deepin_shallowout_final/ouptut/BiasAdd &ltINT8&gt [1, 4] <br></span>[1]</span></td>
  <td>(1) FULLY_CONNECTED</td>
  <td>{'fused_activation_function': 'NONE', 'weights_format': 'DEFAULT', 'keep_num_dims': False}</td>
  <td>None</td>
</tr><tr>
  <td>2</td>
  <td><span class='tooltip'><span class='tooltipcontent'>(1) fc_deepin_shallowout_final/ouptut/BiasAdd &ltINT8&gt [1, 4] <br></span>[1]</span></td>
  <td><span class='tooltip'><span class='tooltipcontent'>(0) Identity_int8 &ltINT8&gt [1, 4] <br></span>[0]</span></td>
  <td>(2) SOFTMAX</td>
  <td>{'beta': 1.0}</td>
  <td>None</td>
</tr><tr>
  <td>3</td>
  <td><span class='tooltip'><span class='tooltipcontent'>(0) Identity_int8 &ltINT8&gt [1, 4] <br></span>[0]</span></td>
  <td><span class='tooltip'><span class='tooltipcontent'>(6) Identity &ltFLOAT32&gt [1, 4] <br></span>[6]</span></td>
  <td>(3) DEQUANTIZE</td>
  <td>None</td>
  <td>None</td>
</tr></table>

<svg id='subgraph0' width='1600' height='900'></svg>
<script>
function buildGraph() {
  // Build graph data
  var graph = {
  "nodes": [
    {
      "id": "o0",
      "name": "(0) QUANTIZE",
      "text_color": "#eeeeee",
      "fill_color": "#000000",
      "edge_radius": 10,
      "x": 200,
      "y": 200,
      "node_width": 95,
      "node_height": 25
    },
    {
      "id": "o1",
      "name": "(1) FULLY_CONNECTED",
      "text_color": "#eeeeee",
      "fill_color": "#000000",
      "edge_radius": 10,
      "x": 200,
      "y": 400,
      "node_width": 147,
      "node_height": 25
    },
    {
      "id": "o2",
      "name": "(2) SOFTMAX",
      "text_color": "#eeeeee",
      "fill_color": "#000000",
      "edge_radius": 10,
      "x": 200,
      "y": 600,
      "node_width": 87,
      "node_height": 25
    },
    {
      "id": "o3",
      "name": "(3) DEQUANTIZE",
      "text_color": "#eeeeee",
      "fill_color": "#000000",
      "edge_radius": 10,
      "x": 200,
      "y": 800,
      "node_width": 110,
      "node_height": 25
    },
    {
      "id": "t0",
      "name": "Identity_int8\n(0) <INT8> [1, 4]",
      "text_color": "#000000",
      "fill_color": "#dddddd",
      "edge_radius": 1,
      "x": 170,
      "y": 700.0,
      "node_width": 132,
      "node_height": 40
    },
    {
      "id": "t1",
      "name": "fc_deepin_shallowout_final/ouptut/BiasAdd\n(1) <INT8> [1, 4]",
      "text_color": "#000000",
      "fill_color": "#dddddd",
      "edge_radius": 1,
      "x": 170,
      "y": 500.0,
      "node_width": 312,
      "node_height": 40
    },
    {
      "id": "t2",
      "name": "fc_deepin_shallowout_final/ouptut/MatMul/ReadVariableOp/transpose\n(2) <INT8> [4, 32]",
      "text_color": "#000000",
      "fill_color": "#fffacd",
      "edge_radius": 1,
      "x": 365,
      "y": 300.0,
      "node_width": 492,
      "node_height": 40
    },
    {
      "id": "t3",
      "name": "fc_deepin_shallowout_final/ouptut/MatMul_bias\n(3) <INT32> [4]",
      "text_color": "#000000",
      "fill_color": "#fffacd",
      "edge_radius": 1,
      "x": 867,
      "y": 300.0,
      "node_width": 342,
      "node_height": 40
    },
    {
      "id": "t4",
      "name": "input_input_int8\n(4) <INT8> [1, 32, 1, 1]",
      "text_color": "#000000",
      "fill_color": "#dddddd",
      "edge_radius": 1,
      "x": 170,
      "y": 300.0,
      "node_width": 185,
      "node_height": 40
    },
    {
      "id": "t5",
      "name": "input_input\n(5) <FLOAT32> [1, 32, 1, 1]",
      "text_color": "#000000",
      "fill_color": "#ccccff",
      "edge_radius": 1,
      "x": 170,
      "y": 100.0,
      "node_width": 207,
      "node_height": 40
    },
    {
      "id": "t6",
      "name": "Identity\n(6) <FLOAT32> [1, 4]",
      "text_color": "#000000",
      "fill_color": "#ffcccc",
      "edge_radius": 1,
      "x": 170,
      "y": 900.0,
      "node_width": 155,
      "node_height": 40
    }
  ],
  "edges": [
    {
      "source": "t5",
      "target": "o0"
    },
    {
      "target": "t4",
      "source": "o0"
    },
    {
      "source": "t4",
      "target": "o1"
    },
    {
      "source": "t2",
      "target": "o1"
    },
    {
      "source": "t3",
      "target": "o1"
    },
    {
      "target": "t1",
      "source": "o1"
    },
    {
      "source": "t1",
      "target": "o2"
    },
    {
      "target": "t0",
      "source": "o2"
    },
    {
      "source": "t0",
      "target": "o3"
    },
    {
      "target": "t6",
      "source": "o3"
    }
  ]
};

  var svg = d3.select("#subgraph0")
  var width = svg.attr("width");
  var height = svg.attr("height");
  // Make the graph scrollable.
  svg = svg.call(d3.zoom().on("zoom", function() {
    svg.attr("transform", d3.event.transform);
  })).append("g");

  var color = d3.scaleOrdinal(d3.schemeDark2);

  var simulation = d3.forceSimulation()
      .force("link", d3.forceLink().id(function(d) {return d.id;}))
      .force("charge", d3.forceManyBody())
      .force("center", d3.forceCenter(0.5 * width, 0.5 * height));

  var edge = svg.append("g").attr("class", "edges").selectAll("line")
    .data(graph.edges).enter().append("path").attr("stroke","black").attr("fill","none")

  // Make the node group
  var node = svg.selectAll(".nodes")
    .data(graph.nodes)
    .enter().append("g")
    .attr("x", function(d){return d.x})
    .attr("y", function(d){return d.y})
    .attr("node_width", function(d){return d.node_width})
    .attr("transform", function(d) {
      return "translate( " + d.x + ", " + d.y + ")"
    })
    .attr("class", "nodes")
      .call(d3.drag()
          .on("start", function(d) {
            if(!d3.event.active) simulation.alphaTarget(1.0).restart();
            d.fx = d.x;d.fy = d.y;
          })
          .on("drag", function(d) {
            d.fx = d3.event.x; d.fy = d3.event.y;
          })
          .on("end", function(d) {
            if (!d3.event.active) simulation.alphaTarget(0);
            d.fx = d.fy = null;
          }));
  // Within the group, draw a box for the node position and text
  // on the side.

  var node_width = 150;
  var node_height = 30;

  node.append("rect")
      .attr("r", "5px")
      .attr("width", function(d) { return d.node_width; })
      .attr("height", function(d) { return d.node_height; })
      .attr("rx", function(d) { return d.edge_radius; })
      .attr("stroke", "#000000")
      .attr("fill", function(d) { return d.fill_color; })
  let text = node.append("text")
      .text("")
      .attr("x", 5)
      .attr("y", 1)
      .attr("fill", function(d) { return d.text_color; });
  text.selectAll("text")
      .data(d => d.name.split("\n"))
      .enter()
      .append("tspan")
      .attr("class", "text")
      .text(d => d)
      .attr("x", 5)
      .attr("dy", 15);

  // Setup force parameters and update position callback

  var node = svg.selectAll(".nodes")
    .data(graph.nodes);

  // Bind the links
  var name_to_g = {}
  node.each(function(data, index, nodes) {
    console.log(data.id)
    name_to_g[data.id] = this;
  });

  function proc(w, t) {
    return parseInt(w.getAttribute(t));
  }
  edge.attr("d", function(d) {
    function lerp(t, a, b) {
      return (1.0-t) * a + t * b;
    }
    var x1 = proc(name_to_g[d.source],"x") + proc(name_to_g[d.source],"node_width") / 2;
    var y1 = proc(name_to_g[d.source],"y") + node_height;
    var x2 = proc(name_to_g[d.target],"x") + proc(name_to_g[d.target],"node_width") / 2;
    var y2 = proc(name_to_g[d.target],"y");
    var s = "M " + x1 + " " + y1
        + " C " + x1 + " " + lerp(.5, y1, y2)
        + " " + x2 + " " + lerp(.5, y1, y2)
        + " " + x2  + " " + y2
    return s;
  });
}

buildGraph()
</script>
</div>

<h2>Buffers</h2>
<table><tr>
  <th>index</th>
  <th>data</th>
</tr><tr>
  <td>0</td>
  <td>--</td>
</tr><tr>
  <td>1</td>
  <td>16 bytes</td>
</tr><tr>
  <td>2</td>
  <td>--</td>
</tr><tr>
  <td>3</td>
  <td>128 bytes</td>
</tr><tr>
  <td>4</td>
  <td>--</td>
</tr><tr>
  <td>5</td>
  <td>--</td>
</tr><tr>
  <td>6</td>
  <td>5 bytes</td>
</tr></table>

<h2>Operator Codes</h2>
<table><tr>
  <th>index</th>
  <th>builtin_code</th>
  <th>custom_code</th>
  <th>version</th>
</tr><tr>
  <td>0</td>
  <td>QUANTIZE</td>
  <td>None</td>
  <td>1</td>
</tr><tr>
  <td>1</td>
  <td>FULLY_CONNECTED</td>
  <td>None</td>
  <td>4</td>
</tr><tr>
  <td>2</td>
  <td>SOFTMAX</td>
  <td>None</td>
  <td>2</td>
</tr><tr>
  <td>3</td>
  <td>DEQUANTIZE</td>
  <td>None</td>
  <td>2</td>
</tr></table>

</body>
</html>
