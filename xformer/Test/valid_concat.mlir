// RUN: xcore-opt --mlir-io %s --xcore-replace-concat | FileCheck %s 

// CHECK-LABEL: valid_concat
func.func @valid_concat(%arg0: tensor<1x2x6x5x2xf32> {tf_saved_model.index_path = ["input_8"]}, %arg1: tensor<1x2x6x5x2xf32> {tf_saved_model.index_path = ["input_7"]}) -> (tensor<1x4x6x5x2xf32> {tf_saved_model.index_path = ["concatenate_3"]}) attributes {tf.entry_function = {inputs = "serving_default_input_8:0,serving_default_input_7:0", outputs = "PartitionedCall:0"}, tf_saved_model.exported_names = ["serving_default"]} {
  // CHECK: xc.concat
  // CHECK-NOT: tfl.concatenation
  %0 = "tfl.quantize"(%arg1) {qtype = tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>} : (tensor<1x2x6x5x2xf32>) -> tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>
  %1 = "tfl.quantize"(%arg0) {qtype = tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756512105464935>>} : (tensor<1x2x6x5x2xf32>) -> tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756512105464935>>
  %2 = "tfl.quantize"(%1) {qtype = tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>} : (tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756512105464935>>) -> tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>
  %3 = "tfl.concatenation"(%0, %2) {axis = 1 : i32, fused_activation_function = "NONE"} : (tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>, tensor<1x2x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>) -> tensor<1x4x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>
  %4 = "tfl.dequantize"(%3) : (tensor<1x4x6x5x2x!quant.uniform<i16:f32, 0.038756620138883591>>) -> tensor<1x4x6x5x2xf32>
  return %4 : tensor<1x4x6x5x2xf32>
}

// CHECK-LABEL: valid_concat_40
func.func @valid_concat_40(%arg0: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_110"]}, %arg1: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_113"]}, %arg2: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_108"]}, %arg3: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_93"]}, %arg4: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_104"]}, %arg5: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_111"]}, %arg6: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_99"]}, %arg7: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_116"]}, %arg8: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_114"]}, %arg9: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_102"]}, %arg10: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_119"]}, %arg11: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_95"]}, %arg12: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_84"]}, %arg13: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_106"]}, %arg14: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_112"]}, %arg15: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_96"]}, %arg16: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_88"]}, %arg17: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_98"]}, %arg18: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_86"]}, %arg19: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_105"]}, %arg20: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_115"]}, %arg21: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_85"]}, %arg22: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_91"]}, %arg23: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_89"]}, %arg24: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_90"]}, %arg25: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_117"]}, %arg26: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_118"]}, %arg27: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_87"]}, %arg28: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_81"]}, %arg29: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_120"]}, %arg30: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_103"]}, %arg31: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_100"]}, %arg32: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_94"]}, %arg33: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_109"]}, %arg34: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_82"]}, %arg35: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_92"]}, %arg36: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_97"]}, %arg37: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_107"]}, %arg38: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_101"]}, %arg39: tensor<1x2x6x5x2xi8> {tf_saved_model.index_path = ["input_83"]}) -> (tensor<1x2x6x200x2xi8> {tf_saved_model.index_path = ["tf.concat_11"]}) attributes {tf.entry_function = {inputs = "serving_default_input_110:0,serving_default_input_113:0,serving_default_input_108:0,serving_default_input_93:0,serving_default_input_104:0,serving_default_input_111:0,serving_default_input_99:0,serving_default_input_116:0,serving_default_input_114:0,serving_default_input_102:0,serving_default_input_119:0,serving_default_input_95:0,serving_default_input_84:0,serving_default_input_106:0,serving_default_input_112:0,serving_default_input_96:0,serving_default_input_88:0,serving_default_input_98:0,serving_default_input_86:0,serving_default_input_105:0,serving_default_input_115:0,serving_default_input_85:0,serving_default_input_91:0,serving_default_input_89:0,serving_default_input_90:0,serving_default_input_117:0,serving_default_input_118:0,serving_default_input_87:0,serving_default_input_81:0,serving_default_input_120:0,serving_default_input_103:0,serving_default_input_100:0,serving_default_input_94:0,serving_default_input_109:0,serving_default_input_82:0,serving_default_input_92:0,serving_default_input_97:0,serving_default_input_107:0,serving_default_input_101:0,serving_default_input_83:0", outputs = "PartitionedCall:0"}, tf_saved_model.exported_names = ["serving_default"]} {
  // CHECK: xc.concat
  // CHECK: xc.concat
  // CHECK: xc.concat
  // CHECK-NOT: tfl.concatenation
  %0 = "tfl.concatenation"(%arg28, %arg34, %arg39, %arg12, %arg21, %arg18, %arg27, %arg16, %arg23, %arg24, %arg22, %arg35, %arg3, %arg32, %arg11, %arg15, %arg36, %arg17, %arg6, %arg31, %arg38, %arg9, %arg30, %arg4, %arg19, %arg13, %arg37, %arg2, %arg33, %arg0, %arg5, %arg14, %arg1, %arg8, %arg20, %arg7, %arg25, %arg26, %arg10, %arg29) {axis = 3 : i32, fused_activation_function = "NONE"} : (tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>, tensor<1x2x6x5x2xi8>) -> tensor<1x2x6x200x2xi8>
  return %0 : tensor<1x2x6x200x2xi8>
}
